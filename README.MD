# 유튜브 클립 생성 시스템 사용 가이드

## 📋 프로젝트 개요

이 시스템은 유튜브 영상에서 5-7초 길이의 클립을 자동 생성하는 도구입니다. 침착맨 영상에서 "재밌는 순간"과 "일반 순간"을 분류하여 머신러닝 학습 데이터를 만드는 것이 목적입니다.

## 🗂️ 디렉토리 구조

```
프로젝트 루트/
├── config.yaml                    # 설정 파일
├── youtube_downloader.py           # 영상 다운로드 스크립트
├── clip_extractor.py              # 클립 생성 스크립트
├── downloads/                     # 원본 영상 저장소
│   ├── 영상제목1/
│   │   ├── 영상제목1_video.mp4   # 비디오 파일
│   │   ├── 영상제목1_audio.m4a   # 오디오 파일
│   │   └── timestamps.csv         # 클립 정보 파일
│   └── 영상제목2/
│       ├── 영상제목2_video.mp4
│       ├── 영상제목2_audio.m4a
│       └── timestamps.csv
└── clips/                         # 생성된 클립 저장소
    ├── funny/                     # 재밌는 클립들
    │   ├── video/
    │   │   ├── f_001_영상제목_10.5_16.2.mp4
    │   │   └── f_002_영상제목_45.0_51.5.mp4
    │   ├── audio/
    │   │   ├── f_001_영상제목_10.5_16.2.m4a
    │   │   └── f_002_영상제목_45.0_51.5.m4a
    │   └── merged/ (옵션)
    │       ├── f_001_영상제목_10.5_16.2.mp4
    │       └── f_002_영상제목_45.0_51.5.mp4
    └── normal/                    # 일반 클립들
        ├── video/
        ├── audio/
        └── merged/
```

## ⚙️ 설정 파일 (config.yaml)

```yaml
# 유튜브 다운로더 및 클립 생성기 설정 파일

download:
  base_directory: downloads
  merge_audio_video: false         # ffmpeg 병합 여부

clips:
  output_directory: clips          # 클립 저장 디렉토리
  min_duration: 5.0               # 최소 클립 길이 (초)
  max_duration: 7.0               # 최대 클립 길이 (초)
  merge_clips: false              # 클립 병합 여부
```

### 설정 옵션 설명:
- **merge_audio_video**: 다운로드 시 비디오+오디오 병합 파일 생성 여부
- **merge_clips**: 클립 생성 시 video+audio 병합 파일 생성 여부
- **min/max_duration**: 유효한 클립으로 인정할 길이 범위

## 🎬 1단계: 영상 다운로드

### 사용법:
```bash
python youtube_downloader.py
```

### 진행 과정:
1. 유튜브 URL 입력 요청
2. 영상 정보 확인 (제목, 길이, 조회수)
3. 사용 가능한 화질/음질 표시
4. **1080p → 720p → 최고화질** 순으로 자동 선택
5. 비디오와 오디오 분리 다운로드
6. 영상별 폴더 생성 및 `timestamps.csv` 템플릿 생성

### 출력 결과:
```
downloads/침착맨_킹받는_순간_모음집/
├── 침착맨_킹받는_순간_모음집_video.mp4
├── 침착맨_킹받는_순간_모음집_audio.m4a
└── timestamps.csv
```

## 📝 2단계: 타임스탬프 라벨링

### timestamps.csv 편집:

1. **Excel에서 열기** (또는 메모장)
2. **CSV 형식으로 저장** (xlsx 저장 금지!)
3. 다음 형식으로 데이터 입력:

```csv
start,end,label
10.5,16.2,funny
45.0,51.5,normal
120.3,125.8,f
200.1,206.8,n
```

### 라벨링 규칙:

#### 유효한 라벨:
- **재밌는 클립**: `funny`, `f`, `F`
- **일반 클립**: `normal`, `n`, `N`

#### 클립 기준:
- **funny**: 웃음 포인트, 리액션이 큰 순간, 예상외의 상황
- **normal**: 평범한 대화, 설명, 일상적인 상황

#### 시간 지정:
- **start**: 클립 시작 시간 (소수점 가능, 예: 10.5초)
- **end**: 클립 종료 시간 (소수점 가능, 예: 16.2초)
- **길이**: 5-7초 사이여야 함 (자동 검증)

### 예시:
```csv
start,end,label
# 침착맨이 게임에서 놀라는 순간
45.3,51.1,funny

# 게임 설명하는 부분  
78.0,84.5,normal

# 웃으면서 리액션하는 부분
156.2,162.8,f

# 평범한 대화
203.5,209.0,n
```

## 🎞️ 3단계: 클립 생성

### 사용법:
```bash
python clip_extractor.py
```

### 진행 과정:

#### 1. 영상 선택:
```
🎬 클립 생성기
==========================================
📋 처리 가능한 영상: 2개
   1. 침착맨_킹받는_순간_모음집
   2. 진짜_개빡치는_게임_실황

선택 옵션:
   0. 모든 영상 자동 처리
   1-2. 개별 영상 선택

선택 (0-2): 1
```

#### 2. 클립 처리:
```
🔄 클립 1/5 처리 중... (45.3-51.1초)
✅ f_001_침착맨_킹받는_순간_모음집_45.3_51.1 생성 완료

🔄 클립 2/5 처리 중... (78.0-84.5초)
✅ n_001_침착맨_킹받는_순간_모음집_78.0_84.5 생성 완료
```

#### 3. 중복 처리:
```
⚠️ 중복 클립 발견: f_001_침착맨_킹받는_순간_모음집_45.3_51.1.mp4
   1. 건너뛰기  2. 덮어쓰기  선택 (1/2): 1
   건너뛰기
```

#### 4. 최종 결과:
```
===============================================
✅ 모든 처리 완료!
   생성됨: 8개
   건너뜀: 1개  
   실패함: 0개
📁 클립 저장 위치: clips/funny/video, clips/normal/video
```

## 📁 클립 파일명 규칙

### 형식:
```
{라벨}_{번호}_{영상제목}_{시작시간}_{종료시간}.{확장자}
```

### 예시:
- **funny 클립**: `f_001_침착맨_킹받는_순간_모음집_45.3_51.1.mp4`
- **normal 클립**: `n_001_침착맨_킹받는_순간_모음집_78.0_84.5.mp4`

### 번호 체계:
- **f_001, f_002, f_003...**: funny 클립 순서
- **n_001, n_002, n_003...**: normal 클립 순서

## ⚠️ 주의사항

### 1. CSV 파일 관리:
- **Excel 저장 시 반드시 CSV 형식으로 저장**
- xlsx 저장 시 스크립트에서 읽을 수 없음
- 편집 완료 후 **Excel 파일을 닫고** 클립 생성 실행

### 2. 파일 권한:
- **관리자 권한으로 실행** (권한 오류 발생 시)
- 바이러스 백신이 ffmpeg 실행을 차단할 수 있음

### 3. 클립 길이:
- **5-7초 범위를 벗어나면 자동으로 무시됨**
- 시작 시간이 종료 시간보다 크면 오류

### 4. 중복 클립:
- 같은 시간대의 클립은 중복으로 감지됨 (±0.1초 오차 허용)
- 중복 시 덮어쓰기 또는 건너뛰기 선택 가능

### 5. ffmpeg 의존성:
- **ffmpeg 설치 필수** (클립 분할용)
- Windows: `winget install ffmpeg` 또는 수동 설치

## 🔧 문제 해결

### 1. "Permission denied" 오류:
```bash
# 해결책
1. Excel/메모장에서 CSV 파일 닫기
2. 관리자 권한으로 실행
3. 다른 디렉토리에 저장 (C:/temp/downloads 등)
```

### 2. "ffmpeg not found" 오류:
```bash
# Windows 설치
winget install ffmpeg

# 또는 수동 설치 후 환경변수 추가
```

### 3. 인코딩 오류:
```bash
# 파일명에 특수문자가 많을 때 발생
# 자동으로 처리되지만, 클립은 정상 생성됨
```

### 4. CSV 파싱 오류:
```bash
# 해결책
1. start, end, label 헤더 확인
2. 숫자 형식 확인 (소수점은 . 사용)
3. 주석 행은 # 으로 시작
```

## 🎯 ML 활용 방안

### 데이터 로딩:
```python
# PyTorch 예시
from torchvision.datasets import ImageFolder
from torch.utils.data import DataLoader

# 비디오 데이터셋
video_dataset = ImageFolder('clips/funny/video')
video_loader = DataLoader(video_dataset, batch_size=32)

# 오디오는 별도 처리
audio_files = glob('clips/funny/audio/*.m4a')
```

### 멀티모달 학습:
- **비디오**: `clips/*/video/` 폴더에서 프레임 추출
- **오디오**: `clips/*/audio/` 폴더에서 특징 추출
- **12차원 시계열**: 감정(10차원) + 음성(2차원) 결합

## 📊 데이터셋 현황 확인

### 클립 개수 확인:
```bash
# Linux/Mac
find clips/funny/video -name "*.mp4" | wc -l
find clips/normal/video -name "*.mp4" | wc -l

# Windows (PowerShell)
(Get-ChildItem clips/funny/video -Filter "*.mp4").Count
(Get-ChildItem clips/normal/video -Filter "*.mp4").Count
```

### 균형 잡힌 데이터셋 목표:
- **funny**: 100-200개 클립
- **normal**: 100-200개 클립
- **총 용량**: 비디오 약 2-5GB, 오디오 약 200-500MB

## 🚀 확장 계획

### 1. 자동 라벨링:
- 음량 급변 구간 → funny 후보
- 평온한 구간 → normal 후보

### 2. 더 많은 라벨:
- `angry`, `excited`, `surprised` 등 추가

### 3. 품질 개선:
- 얼굴 인식으로 침착맨만 필터링
- 음성 인식으로 웃음소리 감지

---

**💡 팁**: 처음에는 적은 수의 클립으로 테스트해본 후, 시스템에 익숙해지면 대량 처리하는 것을 권장합니다!